# system.h & system.c

This file defines configuration parameters for the `engine` and declares the system initialization function.

## MACRO DESCRIPTION

- **`EVENT_QUEUE_SIZE`**  
  - Defines the size of the `EventQueue`.  
  - Choose an appropriate value to prevent overflow during operation.

- **`EVENT_POOL_SIZE`**  
  - Defines the total number of events used in your application.  
  - You can check `engine.eventQueue.poolsize` after registering all events to determine the required size.

- **`MAX_EVENT_SIZE`**  
  - Defines the size of the `tempDataForHandler` array, which temporarily stores fixed event data.  
  - Ensure it is large enough to accommodate the largest `sizeof(dataType)` used in your application.

- **`MAX_STRAND_EVENT_SIZE`**  
    - Only use this MACRO when you use Strand. It means the same as `MAX_EVENT_SIZE` but only affect to your Strand.
    - Ensure it is large enough to accommodate the largest `sizeof(dataType)` used in your strand.

## FUNCTION DESCRIPTION

### `extern void SystemClock_Config();`

- This function is generated by **STM32CubeMX** and is used to initialize the system clock.

---

### `void System_Init()`

- Make sure this function is called right at the start of the `main` function.
- For usage examples, refer to `test/main.c`.

---

### `void SysTick_Handler(void)`

- This function is the **handler for the SysTick interrupt**. Typically, its period is **1 ms**.
- You can use another **TIMER module** to call `Engine_CheckTask()`.
- **If `Engine_CheckTask()` is not called periodically then `M_TASK` cannot operate.**
- The frequency at which `Engine_CheckTask()` is called affects `M_TASK()` timing.

#### `Example 1` `(Calling Engine_CheckTask() every **1 ms**):`
```c
// Period call Engine_CheckTask() is 1 ms
M_TASK_START(name, 10, 5);
// nameTask has period is 10 * 1ms = 10 ms and run 5 times
// Every 10ms, M_TASK_HANDLER(name) is called
// After 50ms nameTask automatically stops
```

#### `Example 2 (Calling Engine_CheckTask() every 10 ms):`
```c
// Period call Engine_CheckTask() is 10 ms
M_TASK_START(name, 20, 3);
// nameTask has period is 20 * 10ms = 200 ms and run 3 times
// Every 200ms, M_TASK_HANDLER(name) is called
// After 600ms nameTask automatically stops
```

---

### `Handling SysTick Conflict in STM32CubeMX`
- After generating code from STM32CubeMX, the function void SysTick_Handler(void) is automatically generated in `Core/src/stm32..._it.c`, leading to build conflicts.

### `Solution`

1. In STM32CubeMX, go to:"NVIC / Code Generation" tab.

2. Disable "Generate IRQ Handler" for "Time base: SysTick Timer".
